/*
 Copyright (c) 2003-2013, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or http://ckeditor.com/license
*/
!function(e){CKEDITOR.config.jqueryOverrideVal="undefined"==typeof CKEDITOR.config.jqueryOverrideVal?!0:CKEDITOR.config.jqueryOverrideVal,"undefined"!=typeof e&&(e.extend(e.fn,{ckeditorGet:function(){var e=this.eq(0).data("ckeditorInstance");if(!e)throw"CKEditor is not initialized yet, use ckeditor() with a callback.";return e},ckeditor:function(t,n){if(!CKEDITOR.env.isCompatible)throw Error("The environment is incompatible.");if(!e.isFunction(t))var i=n,n=t,t=i;var o=[],n=n||{};this.each(function(){var i=e(this),r=i.data("ckeditorInstance"),s=i.data("_ckeditorInstanceLock"),a=this,l=new e.Deferred;o.push(l.promise()),r&&!s?(t&&t.apply(r,[this]),l.resolve()):s?r.once("instanceReady",function(){setTimeout(function(){r.element?(r.element.$==a&&t&&t.apply(r,[a]),l.resolve()):setTimeout(arguments.callee,100)},0)},null,null,9999):((n.autoUpdateElement||"undefined"==typeof n.autoUpdateElement&&CKEDITOR.config.autoUpdateElement)&&(n.autoUpdateElementJquery=!0),n.autoUpdateElement=!1,i.data("_ckeditorInstanceLock",!0),r=e(this).is("textarea")?CKEDITOR.replace(a,n):CKEDITOR.inline(a,n),i.data("ckeditorInstance",r),r.on("instanceReady",function(n){var o=n.editor;setTimeout(function(){if(o.element){if(n.removeListener(),o.on("dataReady",function(){i.trigger("dataReady.ckeditor",[o])}),o.on("setData",function(e){i.trigger("setData.ckeditor",[o,e.data])}),o.on("getData",function(e){i.trigger("getData.ckeditor",[o,e.data])},999),o.on("destroy",function(){i.trigger("destroy.ckeditor",[o])}),o.on("save",function(){return e(a.form).submit(),!1},null,null,20),o.config.autoUpdateElementJquery&&i.is("textarea")&&e(a.form).length){var r=function(){i.ckeditor(function(){o.updateElement()})};e(a.form).submit(r),e(a.form).bind("form-pre-serialize",r),i.bind("destroy.ckeditor",function(){e(a.form).unbind("submit",r),e(a.form).unbind("form-pre-serialize",r)})}o.on("destroy",function(){i.removeData("ckeditorInstance")}),i.removeData("_ckeditorInstanceLock"),i.trigger("instanceReady.ckeditor",[o]),t&&t.apply(o,[a]),l.resolve()}else setTimeout(arguments.callee,100)},0)},null,null,9999))});var r=new e.Deferred;return this.promise=r.promise(),e.when.apply(this,o).then(function(){r.resolve()}),this.editor=this.eq(0).data("ckeditorInstance"),this}}),CKEDITOR.config.jqueryOverrideVal&&(e.fn.val=CKEDITOR.tools.override(e.fn.val,function(t){return function(n){if(arguments.length){var i=this,o=[],r=this.each(function(){var i=e(this),r=i.data("ckeditorInstance");if(i.is("textarea")&&r){var s=new e.Deferred;return r.setData(n,function(){s.resolve()}),o.push(s.promise()),!0}return t.call(i,n)});if(o.length){var s=new e.Deferred;return e.when.apply(this,o).done(function(){s.resolveWith(i)}),s.promise()}return r}var r=e(this).eq(0),a=r.data("ckeditorInstance");return r.is("textarea")&&a?a.getData():t.call(r)}})))}(window.jQuery);